---
# 全環境共通の構造定義と基幹変数

# アプリケーション基本情報
app_name: "art-gallery"

# 各サービスのリポジトリ名・イメージ名の一元管理
service_repo_names:
  postgres: "art-gallery-database"
  backend: "art-gallery-backend"
  nginx: "art-gallery-nginx"
  frontend: "art-gallery-frontend"
  secrets: "art-gallery-secrets"

# Dockerイメージのベースバージョン管理
# node は Frontend ビルドを CI 側で実施するため管理対象外
base_image_versions:
  python: "3.11-slim"
  postgres: "17"
  nginx: "1.25-alpine"

# Database接続設定
database_host: "localhost"
database_port: 5432

# Database マイグレーションのバージョン管理
database_migration:
  target_version: "{{ database_target_version | mandatory('database_target_version must be provided') }}"
  history_table: "schema_migrations"
  migrations_base_path: "{{ deployment_paths.src_dir }}/{{ service_repo_names.postgres }}/migrations"

# GitHub & GHCR 設定
github_owner: "s-hikonyan-sys"
ghcr_base_registry: "ghcr.io"

# デプロイ関連ディレクトリ設定
deployment_paths:
  deployment_dir: "{{ deployment_dir }}"
  src_dir: "{{ deployment_paths.deployment_dir }}/src"
  dist_dir: "{{ deployment_paths.deployment_dir }}/dist"
  conf_dir: "{{ deployment_paths.deployment_dir }}/conf"
  logs_dir: "{{ deployment_paths.deployment_dir }}/logs"
  remote_temp_dir: "{{ deployment_paths.deployment_dir }}/tmp"

# コンテナ・イメージ名の命名規則
container_names:
  postgres: "{{ app_name }}-db"
  backend: "{{ app_name }}-api"
  nginx: "{{ app_name }}-nginx"
  secrets: "{{ app_name }}-secrets-api"

# URL設定
frontend_url: "{{ 'https' if ssl_enabled else 'http' }}://{{ domain_name }}"

# Dockerネットワーク名
docker_network_name: "{{ app_name }}-network"

secrets_api_url: "http://art-gallery-secrets-api:5000"

# Dockerボリューム名
docker_volume_postgres_data: "{{ app_name }}_postgres_data"

# コンテナフィルター名
container_filter_name: "{{ app_name }}"

# ヘルスチェック等の共通設定
health_check:
  backend_path: "/api/health"
  postgres:
    interval: "10s"
    timeout: "5s"
    retries: 5
